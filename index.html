<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AI Tuner v4.0 - Customize AI Response Style</title>
    <link rel="stylesheet" href="style.css?v=4.0.0">
    <link rel="stylesheet" href="style-v3.0.css?v=4.0.0">
    <style>
        /* Force dark mode colors - loaded last to override everything */
        body.dark-mode .radar-container-box,
        body.dark-mode .radar-container-box h3,
        body.dark-mode .radar-container-box * {
            color: #ffffff !important;
        }
        
        body.dark-mode .prompt-container-box,
        body.dark-mode .prompt-container-box h3,
        body.dark-mode .prompt-container-box * {
            color: #ffffff !important;
        }
        
        body.dark-mode .step-number {
            background: #ffffff !important;
            color: #000000 !important;
            border-color: #ffffff !important;
        }
        
        /* Exceptions for buttons inside containers */
        body.dark-mode .radar-container-box .btn,
        body.dark-mode .prompt-container-box .btn {
            color: #ffffff !important;
        }
        
        body.dark-mode .radar-container-box .btn-primary,
        body.dark-mode .prompt-container-box .btn-primary {
            background: #ffffff !important;
            color: #000000 !important;
        }
    </style>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: flex-end; align-items: center; gap: 10px; margin-bottom: 20px;">
                <div style="display: flex; gap: 10px;">
                    <button id="emoji-shutoff-toggle" class="btn btn-secondary" style="font-size: 1rem; padding: 8px 16px;">
                        <span id="emoji-shutoff-text">No Emojis</span>
                    </button>
                    <button id="dark-mode-toggle" class="btn btn-secondary" style="font-size: 1rem; padding: 8px 16px;">
                        <span id="dark-mode-text">Dark Mode</span>
                    </button>
                </div>
            </div>
            <h1>AI Tuner v4.0</h1>
            <p class="subtitle">Customize AI behavior with precision controls</p>
            
            <!-- Quick Start Guide -->
            <div class="quick-start-guide" id="quick-start-guide">
                <div class="quick-start-step">
                    <div class="quick-start-icon">
                        <i data-lucide="sparkles"></i>
                    </div>
                    <div class="quick-start-content">
                        <h3>1. Choose</h3>
                        <p>Select your AI model</p>
                    </div>
                </div>
                <div class="quick-start-arrow">
                    <i data-lucide="arrow-right"></i>
                </div>
                <div class="quick-start-step">
                    <div class="quick-start-icon">
                        <i data-lucide="sliders-horizontal"></i>
                    </div>
                    <div class="quick-start-content">
                        <h3>2. Tune</h3>
                        <p>Adjust sliders to customize</p>
                    </div>
                </div>
                <div class="quick-start-arrow">
                    <i data-lucide="arrow-right"></i>
                </div>
                <div class="quick-start-step">
                    <div class="quick-start-icon">
                        <i data-lucide="clipboard-copy"></i>
                    </div>
                    <div class="quick-start-content">
                        <h3>3. Copy</h3>
                        <p>Copy the generated prompt</p>
                    </div>
                </div>
            </div>
            
            <!-- Expandable Info Section -->
            <div class="app-info-section" style="margin-top: 30px;">
                <button id="app-info-toggle" class="app-info-toggle">
                    <span class="app-info-toggle-text">What is AI Tuner?</span>
                    <span class="app-info-toggle-icon">▼</span>
                </button>
                <div id="app-info-content" class="app-info-content">
                    <div class="app-info-inner">
                        <h3>About AI Tuner</h3>
                        <p>AI Tuner removes the mystery from every chatbot.</p>
                        <p>No more guessing why an AI answers the way it does. No more fighting hidden defaults.</p>
                        <p>With one click you see exactly how the AI is wired — and with one drag you change it.</p>
                        
                        <h4>How It Works</h4>
                        <ol class="app-info-steps">
                            <li><strong>Pick any AI</strong><br>Grok • ChatGPT • Claude • Gemini • Perplexity • Mistral • Llama</li>
                            <li><strong>See inside its mind</strong><br>A live radar web instantly shows the AI's current personality — empathy, bluntness, creativity, speed, truth-focus… everything.</li>
                            <li><strong>Tune it your way</strong>
                                <ul class="app-info-substeps">
                                    <li><strong>New users:</strong> Tap a picture (Therapist, Coder, Researcher, Friend, Scam Hunter…) and the AI changes instantly.</li>
                                    <li><strong>Power users:</strong> Drag any of the 26 axes on the radar web for total control.</li>
                                    <li><strong>Everyone:</strong> Watch the radar spin and the prompt update in real time.</li>
                                </ul>
                            </li>
                        </ol>
                        
                        <h4>Key Features</h4>
                        <ul class="app-info-features">
                            <li><strong>Takes the black box out of AI</strong> — every behavior is visible and movable</li>
                            <li><strong>Works on every major model</strong> (no API keys needed)</li>
                            <li><strong>26 precision levers + one-tap personas</strong></li>
                            <li><strong>Beginner mode (8 big picture axes) → Advanced mode (full 26-axis web)</strong></li>
                            <li><strong>Save and share your presets</strong></li>
                            <li><strong>Copy-paste prompt or use the upcoming AI Tuner Portal</strong> (one window, every AI)</li>
                        </ul>
                        
                        <p>Whether you're four years old or fifty years in tech,</p>
                        <p><strong>AI Tuner makes every chatbot feel like it was built just for you.</strong></p>
                        
                        <p><em><strong>Try it now – no signup, no mystery.</strong></em></p>
                    </div>
                </div>
            </div>
    </header>

    <!-- Mode Tabs -->
    <div class="mode-tabs-wrapper" role="tablist" aria-label="Tuning mode">
        <button class="mode-tab active" data-tab="simple" id="tab-simple" type="button" role="tab" aria-selected="true" aria-controls="tab-content-simple" tabindex="0">
            <span class="tab-icon" aria-hidden="true"><i data-lucide="sparkles"></i></span>
            <span class="tab-label">Simple</span>
            <span class="tab-description">12 essential levers</span>
        </button>
        <button class="mode-tab" data-tab="advanced" id="tab-advanced" type="button" role="tab" aria-selected="false" aria-controls="tab-content-advanced" tabindex="-1">
            <span class="tab-icon" aria-hidden="true"><i data-lucide="settings"></i></span>
            <span class="tab-label">Advanced</span>
            <span class="tab-description">8 levers</span>
        </button>
    </div>

    <main>
        <div class="tab-content active" data-tab-content="simple" id="tab-content-simple" aria-hidden="false">
            <!-- Simple Container (Top) -->
            <div class="simple-container" id="simple-container">
                <!-- Floating Preview Section (side-by-side) -->
                <div class="floating-preview-wrapper" id="floating-preview-wrapper">
                    <!-- Radar Container Box -->
                    <div class="radar-container-box floating-radar">
                        <h3>Live Preview</h3>
                        <div class="radar-wrapper">
                            <canvas id="radarCanvas"></canvas>
                        </div>
                    </div>
                    
                    <!-- Prompt Slot (Simple) -->
                    <div class="prompt-slot" id="simple-prompt-slot">
                        <div class="prompt-container-box floating-prompt" id="prompt-panel">
                            <h3>Generated Prompt</h3>
                            <div class="prompt-preview-wrapper">
                                <div class="prompt-preview" id="prompt-preview">
                                    <p class="placeholder-text">← Start by selecting a model (Step 1)</p>
                                </div>
                                <div class="actions">
                                    <button id="copy-prompt" class="btn btn-primary">Copy Prompt</button>
                                    <button id="save-preset" class="btn btn-secondary">Save Preset</button>
                                    <button id="download-json" class="btn btn-secondary">Download Config</button>
                                    <button id="download-markdown" class="btn btn-secondary">Download Doc</button>
                                    <button id="upload-config" class="btn btn-secondary">Upload Config</button>
                                </div>
                            </div>
                            <input type="file" id="file-input" accept=".json" style="display: none;">
                        </div>
                    </div>
                </div>

                <!-- Personality & Approach Selector (moved here) -->
                <div class="personality-selector-section" style="margin: 30px 0; padding: 20px; border: 2px solid #000; border-radius: 4px; background: #fff;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <h2 style="margin: 0; font-size: 1.3rem; font-weight: 500;">Personality & Approach</h2>
                        <span class="info-btn-step" data-step="personality" style="cursor: pointer; width: 20px; height: 20px; border-radius: 50%; border: 1px solid #000; display: inline-flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 600; background: #000; color: #fff;">ℹ</span>
                    </div>
                    <label for="personality-select" style="display: block; margin-bottom: 8px; font-weight: 500; color: #666;">Intellectual Style</label>
                    <select id="personality-select" class="personality-select">
                        <option value="neutral">Neutral - Objective, balanced</option>
                        <option value="socratic">Socratic - Question-driven, probing</option>
                        <option value="curious">Curious - Inquisitive, exploratory</option>
                        <option value="analytical">Analytical - Methodical, systematic</option>
                        <option value="sarcastic">Sarcastic - Sharp, ironic</option>
                        <option value="witty">Witty - Clever, humorous</option>
                        <option value="charming">Charming - Engaging, charismatic</option>
                        <option value="sympathetic">Sympathetic - Understanding, supportive</option>
                        <option value="empathetic">Empathetic - Emotionally attuned</option>
                        <option value="directive">Directive - Authoritative, commanding</option>
                        <option value="collaborative">Collaborative - Cooperative, inclusive</option>
                        <option value="provocative">Provocative - Challenging, thought-provoking</option>
                    </select>
                </div>

                <!-- Step 1: Choose Model -->
                <div class="workflow-step step-1">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-title">
                            <h2>
                                <span>Choose Your AI Model <span class="info-btn-step" data-step="1">ℹ</span></span>
                                <button id="reset-model-btn" class="reset-tuner-btn" title="Reset Model Selection">Reset</button>
                            </h2>
                            <p class="step-description">Select the AI platform you want to tune. This sets the foundation with the model's default persona.</p>
                        </div>
                    </div>
                    <div class="model-grid" id="model-selector">
                        <!-- Models will be populated by JavaScript with embedded radar previews -->
                    </div>
                </div>

                <!-- Step 2: Apply Hidden Mode -->
                <div class="workflow-step step-2">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-title">
                            <h2>
                                <span>Apply Hidden Mode <span class="info-btn-step" data-step="2">ℹ</span></span>
                                <button id="reset-persona-btn" class="reset-tuner-btn" title="Reset Persona Selection">Reset</button>
                            </h2>
                            <p class="step-description">Apply a specialized persona from the secret menu. These override the default model persona.</p>
                        </div>
                    </div>
                    <div class="persona-grid" id="persona-selector">
                        <!-- Personas will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Step 3: 8-Axis Fine Tuner (Simple Mode Only) -->
                <div class="workflow-step step-3">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-title">
                            <h2>Fine-Tune Your Settings <span class="info-btn-step" data-step="3">ℹ</span></h2>
                            <p class="step-description">Adjust these 8 key levers to customize the AI's behavior.</p>
                        </div>
                    </div>
                    <div class="eight-axis-tuner" id="eight-axis-tuner">
                        <!-- 8 sliders will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Saved Presets (Simple Tab) -->
            <div class="saved-presets-separator">
                <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 15px;">Saved Presets</h3>
                <div id="saved-presets-container" class="preset-buttons-header">
                    <p class="no-presets-message" style="color: #999; font-style: italic; margin: 0; font-size: 0.9rem;">No saved presets yet. Create one using "Save Preset" button.</p>
                </div>
            </div>
        </div>

        <div class="tab-content" data-tab-content="advanced" id="tab-content-advanced" aria-hidden="true">
            <!-- Advanced Container -->
            <div class="advanced-container" id="advanced-container">
                <div class="advanced-header">
                    <h2>Advanced Tuning</h2>
                    <p class="advanced-description">Full control with 4 Web Tuners and 32 tuning lever controls</p>
                </div>

                <!-- Advanced Floating Preview (prompt + 4 radars side-by-side, sticky above sliders) -->
                <div class="advanced-floating-wrapper" id="advanced-floating-wrapper">
                    <!-- Prompt slot (above radars) -->
                    <div class="prompt-slot" id="advanced-prompt-slot"></div>
                    
                    <!-- 4 Radars side-by-side -->
                    <div class="advanced-radar-grid">
                        <div class="advanced-radar-card">
                            <div class="advanced-radar-header">
                                <h4>Persona Spine <span class="web-tuner-info-btn" data-tuner="persona-spine" title="Learn more about Persona Spine">ℹ</span></h4>
                                <button class="advanced-radar-reset" onclick="window.aiTuner.resetWebTuner('persona-spine')" title="Reset to default">
                                    <i data-lucide="rotate-ccw"></i>
                                    <span>Reset</span>
                                </button>
                            </div>
                            <canvas id="web-tuner-persona-spine"></canvas>
                        </div>
                        <div class="advanced-radar-card">
                            <div class="advanced-radar-header">
                                <h4>Engagement Surface <span class="web-tuner-info-btn" data-tuner="engagement" title="Learn more about Engagement Surface">ℹ</span></h4>
                                <button class="advanced-radar-reset" onclick="window.aiTuner.resetWebTuner('engagement')" title="Reset to default">
                                    <i data-lucide="rotate-ccw"></i>
                                    <span>Reset</span>
                                </button>
                            </div>
                            <canvas id="web-tuner-engagement"></canvas>
                        </div>
                        <div class="advanced-radar-card">
                            <div class="advanced-radar-header">
                                <h4>Truth Discipline <span class="web-tuner-info-btn" data-tuner="truth" title="Learn more about Truth Discipline">ℹ</span></h4>
                                <button class="advanced-radar-reset" onclick="window.aiTuner.resetWebTuner('truth')" title="Reset to default">
                                    <i data-lucide="rotate-ccw"></i>
                                    <span>Reset</span>
                                </button>
                            </div>
                            <canvas id="web-tuner-truth"></canvas>
                        </div>
                        <div class="advanced-radar-card">
                            <div class="advanced-radar-header">
                                <h4>Delivery System <span class="web-tuner-info-btn" data-tuner="delivery" title="Learn more about Delivery System">ℹ</span></h4>
                                <button class="advanced-radar-reset" onclick="window.aiTuner.resetWebTuner('delivery')" title="Reset to default">
                                    <i data-lucide="rotate-ccw"></i>
                                    <span>Reset</span>
                                </button>
                            </div>
                            <canvas id="web-tuner-delivery"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Sticky Web Tuners Wrapper -->
                <div class="web-tuners-sticky-wrapper">
                    <div class="web-tuners-grid-4x1">
                        <!-- Persona Spine Tuner -->
                        <div class="web-tuner-panel" id="web-tuner-panel-persona-spine">
                            <h4>Persona Spine <span class="web-tuner-info-btn" data-tuner="persona-spine" title="Learn more about Persona Spine">ℹ</span></h4>
                            <div class="web-tuner-sliders" id="web-tuner-sliders-persona-spine">
                                <!-- Sliders grouped here -->
                            </div>
                        </div>
                        
                        <!-- Engagement Surface Tuner -->
                        <div class="web-tuner-panel" id="web-tuner-panel-engagement">
                            <h4>Engagement Surface <span class="web-tuner-info-btn" data-tuner="engagement" title="Learn more about Engagement Surface">ℹ</span></h4>
                            <div class="web-tuner-sliders" id="web-tuner-sliders-engagement">
                                <!-- Sliders grouped here -->
                            </div>
                        </div>
                        
                        <!-- Truth Discipline Tuner -->
                        <div class="web-tuner-panel" id="web-tuner-panel-truth">
                            <h4>Truth Discipline <span class="web-tuner-info-btn" data-tuner="truth" title="Learn more about Truth Discipline">ℹ</span></h4>
                            <div class="web-tuner-sliders" id="web-tuner-sliders-truth">
                                <!-- Sliders grouped here -->
                            </div>
                        </div>
                        
                        <!-- Delivery System Tuner -->
                        <div class="web-tuner-panel" id="web-tuner-panel-delivery">
                            <h4>Delivery System <span class="web-tuner-info-btn" data-tuner="delivery" title="Learn more about Delivery System">ℹ</span></h4>
                            <div class="web-tuner-sliders" id="web-tuner-sliders-delivery">
                                <!-- Sliders grouped here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- All Other Levers (not in the 8 core or 4 web tuners) -->
                <div class="advanced-other-levers" id="advanced-other-levers">
                    <!-- Remaining levers will be populated here -->
                </div>

                <!-- Saved Presets (Advanced Tab) -->
                <div class="saved-presets-separator">
                    <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 15px;">Saved Presets</h3>
                    <div id="saved-presets-container-advanced" class="preset-buttons-header">
                        <p class="no-presets-message" style="color: #999; font-style: italic; margin: 0; font-size: 0.9rem;">No saved presets yet. Create one using "Save Preset" button.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>
    </div>

    <!-- Info Popup Overlay -->
    <div id="info-overlay" class="info-overlay">
        <div class="info-popup">
            <div class="info-header">
                <h3 id="info-title">Lever Information</h3>
                <button id="info-close" class="info-close">×</button>
            </div>
            <div class="info-content" id="info-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Chart.js with fallback for mobile -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" 
            onerror="this.onerror=null; loadChartJSFallback();"></script>
    <script>
        // Fallback if CDN fails (common on mobile)
        function loadChartJSFallback() {
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/chart.js@latest/dist/chart.umd.js';
            script.onerror = function() {
                console.error('All Chart.js CDNs failed');
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: #ff0000; color: #fff; padding: 15px; z-index: 10000; text-align: center; font-size: 14px;';
                errorDiv.innerHTML = '⚠️ Chart.js failed to load. The radar chart may not work, but the rest of the app should function. <button onclick="location.reload()" style="margin-left: 10px; padding: 5px 10px; background: #fff; color: #000; border: none; cursor: pointer;">Reload</button>';
                document.body.appendChild(errorDiv);
            };
            document.head.appendChild(script);
        }
    </script>
    <script src="js/data/v3.0-models.js?v=4.0.0"></script>
    <script src="js/data/v3.0-levers.js?v=4.0.0"></script>
    <script src="js/data/v3.0-personas.js?v=4.0.0"></script>
    <script src="js/data/v4.0-personas.js?v=4.0.0"></script>
    <script src="radar.js?v=4.0.0"></script>
    <!-- Analytics -->
    <script defer data-domain="aituner.app" src="https://plausible.io/js/script.js"></script>
    <script>
        window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) };
    </script>
    <script src="analytics.js?v=4.0.0"></script>
    <script src="js/core/v3.0-engine.js?v=4.0.0"></script>
    <script>
        (function() {
            function setupTabs() {
                const tabs = Array.from(document.querySelectorAll('.mode-tab'));
                const tabContents = Array.from(document.querySelectorAll('.tab-content'));
                const promptPanel = document.getElementById('prompt-panel');
                const promptSlots = {
                    simple: document.getElementById('simple-prompt-slot'),
                    advanced: document.getElementById('advanced-prompt-slot')
                };

                if (!tabs.length || !tabContents.length) {
                    return;
                }

                function movePromptTo(tabKey) {
                    if (!promptPanel) return;
                    const slot = promptSlots[tabKey];
                    if (slot && slot !== promptPanel.parentElement) {
                        slot.appendChild(promptPanel);
                    }
                }

                function setActiveTab(tabKey) {
                    const target = tabKey === 'advanced' ? 'advanced' : 'simple';
                    tabs.forEach((tab) => {
                        const isActive = tab.dataset.tab === target;
                        tab.classList.toggle('active', isActive);
                        tab.setAttribute('aria-selected', String(isActive));
                        tab.setAttribute('tabindex', isActive ? '0' : '-1');
                    });

                    tabContents.forEach((content) => {
                        const isActive = content.dataset.tabContent === target;
                        content.classList.toggle('active', isActive);
                        content.setAttribute('aria-hidden', String(!isActive));
                    });

                    movePromptTo(target);
                    localStorage.setItem('aiTunerActiveTab', target);

                    // Track tab switch
                    if (window.aiTunerAnalytics) {
                        window.aiTunerAnalytics.trackTabSwitch(target);
                    }

                    // Initialize Lucide icons after tab switch
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                    }

                    // Allow layout to settle, then trigger resize for charts
                    setTimeout(() => {
                        window.dispatchEvent(new Event('resize'));
                    }, 150);
                }

                tabs.forEach((tab) => {
                    tab.addEventListener('click', (event) => {
                        event.preventDefault();
                        const targetTab = tab.dataset.tab;
                        setActiveTab(targetTab);
                    });
                });

                const savedTab = localStorage.getItem('aiTunerActiveTab') || 'simple';
                setActiveTab(savedTab);
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupTabs);
            } else {
                setupTabs();
            }
        })();
    </script>
    <script>
        // Force cache refresh on mobile if needed
        (function() {
            const version = '4.0.0';
            const storedVersion = localStorage.getItem('aituner-version');
            if (storedVersion !== version) {
                localStorage.setItem('aituner-version', version);
                // Force reload if version changed
                if (storedVersion && storedVersion !== version) {
                    window.location.reload(true);
                }
            }
        })();
        
        // SIMPLIFIED: No DOM manipulation - let CSS handle mobile layout
        // The radar chart stays in its original position, CSS handles reordering on mobile
        
        // Error handling and loading state
        window.addEventListener('error', function(e) {
            // Ignore Chart.js resize errors that we're handling
            if (e.message && (
                e.message.includes('ownerDocument') ||
                e.message.includes('Chart.js') ||
                e.filename && e.filename.includes('chart.js')
            )) {
                // These are handled by our resize handler, just log a warning
                console.warn('Chart.js resize error (handled):', e.message);
                return;
            }
            
            console.error('JavaScript Error:', e.message, e.filename, e.lineno);
            // Only show critical errors to user
            if (!e.message || (!e.message.includes('ownerDocument') && !e.message.includes('Chart.js'))) {
                // Show error message to user for non-Chart.js errors
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: #ff0000; color: #fff; padding: 10px; z-index: 10000; text-align: center;';
                errorDiv.textContent = 'Error loading page. Check console for details.';
                document.body.appendChild(errorDiv);
            }
        });
        
        // Initialize on page load
        window.addEventListener('load', function() {
            // Mobile-specific: Check if we're on mobile
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
        });
        
        // Initialize v4.0 app

        // Load dark mode preference BEFORE DOMContentLoaded to prevent flash
        (function() {
            const savedDarkMode = localStorage.getItem('aiTunerDarkMode') === 'true';
            if (savedDarkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        })();
        
        // Wait for all scripts to load, especially on mobile
        let isInitializing = false;
        let isInitialized = false;
        
        function initializeApp() {
            // Prevent multiple initializations
            if (isInitializing || isInitialized) {
                return;
            }
            
            isInitializing = true;
            
            // Check critical dependencies
            if (typeof window.AITunerV6 === 'undefined') {
                isInitializing = false;
                console.error('AITunerV6 not loaded!');
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: #ff0000; color: #fff; padding: 15px; z-index: 10000; text-align: center; font-size: 14px;';
                errorDiv.innerHTML = '❌ Application script failed to load. <button onclick="location.reload()" style="margin-left: 10px; padding: 5px 10px; background: #fff; color: #000; border: none; cursor: pointer; border-radius: 4px;">Reload Page</button>';
                document.body.appendChild(errorDiv);
                return;
            }
            
            // Chart.js is optional - app can work without it
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js not loaded - radar chart will not work, but app will continue');
                // Don't block initialization, just warn
            }
            
            try {
                window.aiTuner = new window.AITunerV6();
                isInitialized = true;
                
                // Hide loader if still visible
                const loader = document.getElementById('page-loader');
                if (loader) {
                    loader.style.opacity = '0';
                    loader.style.transition = 'opacity 0.3s';
                    setTimeout(() => loader.remove(), 300);
                }
            } catch (error) {
                console.error('Error initializing AI Tuner:', error);
                isInitializing = false;
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: #ff0000; color: #fff; padding: 15px; z-index: 10000; text-align: center; font-size: 14px;';
                errorDiv.innerHTML = '❌ Error: ' + (error.message || 'Unknown error') + ' <button onclick="location.reload()" style="margin-left: 10px; padding: 5px 10px; background: #fff; color: #000; border: none; cursor: pointer; border-radius: 4px;">Reload</button>';
                document.body.appendChild(errorDiv);
            } finally {
                isInitializing = false;
            }
        }
        
        // Try to initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener("DOMContentLoaded", () => {
                // Give scripts a moment to load, especially on mobile
                setTimeout(initializeApp, 100);
            });
        } else {
            // DOM already loaded
            setTimeout(initializeApp, 100);
        }
        
        // Also try on window load as backup
        window.addEventListener('load', () => {
            // If app hasn't initialized yet, try again
            if (!window.aiTuner && !isInitialized && !isInitializing) {
                setTimeout(initializeApp, 200);
            }
        });
        
        // Add loading indicator
        (function() {
            const loader = document.createElement('div');
            loader.id = 'page-loader';
            loader.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #fff; z-index: 9999; display: flex; align-items: center; justify-content: center; font-size: 18px;';
            loader.textContent = 'Loading AI Tuner...';
            document.body.appendChild(loader);
            
            window.addEventListener('load', function() {
                setTimeout(function() {
                    const loaderEl = document.getElementById('page-loader');
                    if (loaderEl) {
                        loaderEl.style.opacity = '0';
                        loaderEl.style.transition = 'opacity 0.3s';
                        setTimeout(function() {
                            loaderEl.remove();
                        }, 300);
                    }
                }, 500);
            });
        })();
    </script>
</body>
</html>